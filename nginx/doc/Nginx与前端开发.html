<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<h3 class="" data-id="heading-0"
    style="box-sizing: border-box;margin-top: 1.6em;margin-bottom: 1.6em;font-weight: bold;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;border-bottom: 2px solid rgb(239, 112, 96);letter-spacing: 2px;white-space: normal;word-spacing: 2px;background-color: rgb(255, 255, 255);">
  <span
    style="box-sizing: border-box;margin-right: 3px;padding: 3px 10px 1px;font-size: inherit;color: rgb(255, 255, 255);line-height: inherit;display: inline-block;font-weight: normal;background: rgb(239, 112, 96);border-top-right-radius: 3px;border-top-left-radius: 3px;">Nginx与Node.js</span>
</h3>
<blockquote
  style="box-sizing: border-box;margin-top: 1em;margin-bottom: 1em;padding: 15px 15px 15px 1rem;border-left-width: 5px;border-left-color: rgb(239, 112, 96);font-size: 0.9em;line-height: inherit;background: rgb(239, 235, 233);overflow: auto;word-wrap: normal;word-break: normal;letter-spacing: 2px;white-space: normal;word-spacing: 2px;">
  <p style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;">
    “Nginx是一款轻量级的HTTP服务器，采用事件驱动的异步非阻塞处理方式框架，这让其具有极好的IO性能，时常用于服务端的反向代理和负载均衡。”</p></blockquote>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;letter-spacing: 2px;white-space: normal;word-spacing: 2px;background-color: rgb(255, 255, 255);">
  “HTTP服务器”、“事件驱动”、“异步非阻塞”</p>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;letter-spacing: 2px;white-space: normal;word-spacing: 2px;background-color: rgb(255, 255, 255);">
  Nginx更擅长于底层服务器端资源的处理（静态资源处理转发、反向代理，负载均衡等），Node.js更擅长于上层具体业务逻辑的处理。两者可以实现完美组合，助力前端开发。</p>
<h3 class="" data-id="heading-1"
    style="box-sizing: border-box;margin-top: 1.6em;margin-bottom: 1.6em;font-weight: bold;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;border-bottom: 2px solid rgb(239, 112, 96);letter-spacing: 2px;white-space: normal;word-spacing: 2px;background-color: rgb(255, 255, 255);">
  <span
    style="box-sizing: border-box;margin-right: 3px;padding: 3px 10px 1px;font-size: inherit;color: rgb(255, 255, 255);line-height: inherit;display: inline-block;font-weight: normal;background: rgb(239, 112, 96);border-top-right-radius: 3px;border-top-left-radius: 3px;">反向代理</span>
</h3>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;letter-spacing: 2px;white-space: normal;word-spacing: 2px;background-color: rgb(255, 255, 255);">
  什么是反向代理？ 互联网应用基本都基于CS基本结构，即client端和server端。代理其实就是在client端和真正的server端之前增加一层提供特定服务的服务器，即代理服务器。</p>
<ol style="" class="list-paddingleft-2">
  <li><p><strong
    style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">正向代理</strong>&nbsp，翻墙工具其实就是一个正向代理工具。它会把
    们访问墙外服务器server的网页请求，代理到一个可以访问该网站的代理服务器proxy，这个代理服务器proxy把墙外服务器server上的网页内容获取，再转发给客户。具体的流程如下图。</p>
    <figure style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;">
      <img
          data-height="467"
          data-ratio="0.7472"
          data-src="https://mmbiz.qpic.cn/mmbiz/1NOXMW586usW91ALT7WS6fm56aB7eMYusBiccYkvtrPUD2xDHqmHnGXrpKhDua4lPK8y57o8bj7Je2BXIjtgabw/640?wx_fmt=other"
          data-type="other"
          data-w="625"
          data-width="625"
          style="box-sizing: border-box; margin-right: auto; margin-left: auto; border-width: 2px; border-style: solid; border-color: rgb(238, 238, 238); border-radius: 6px; font-size: inherit; color: inherit; line-height: inherit; display: block; width: 625px !important; height: auto !important; visibility: visible !important;"
          _width="625px"
          src="./Nginx与前端开发_files/640"
          crossorigin="anonymous"
          alt="图片"
          data-fail="0">
      <figcaption
        style="box-sizing: border-box;margin-top: 10px;font-size: 0.7em;color: rgb(153, 153, 153);line-height: inherit;text-align: center;">
        nginx-proxy
      </figcaption>
    </figure>
    <p>概括说：就是客户端和代理服务器可以直接互相访问，属于一个LAN（局域网）；代理对用户是<strong
      style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">非透明</strong>的，即用户需要自己操作或者感知得到自己的请求被发送到代理服务器；代理服务器通过<strong
      style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">代理用户端的请求</strong>来向域外服务器请求响应内容。
    </p></li>
  <li><p><strong
    style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">反向代理</strong>&nbsp;<strong
    style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">反向代理</strong>则正好相反，先看流程图图。
  </p>
    <figure style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;"><img class=""
                                                                                                        data-height="499"
                                                                                                        data-ratio="0.7618320610687023"
                                                                                                        data-src="https://mmbiz.qpic.cn/mmbiz/1NOXMW586usW91ALT7WS6fm56aB7eMYuflj6FkkUlPxLJeFDkOKc7UhUAyBkqxia52Lr9ma6EzjFwnLYCH4HrPA/640?wx_fmt=other"
                                                                                                        data-type="other"
                                                                                                        data-w="655"
                                                                                                        data-width="655"
                                                                                                        style="box-sizing: border-box; margin-right: auto; margin-left: auto; border-width: 2px; border-style: solid; border-color: rgb(238, 238, 238); border-radius: 6px; font-size: inherit; color: inherit; line-height: inherit; display: block; width: 655px !important; height: auto !important; visibility: visible !important;"
                                                                                                        _width="655px"
                                                                                                        src="./Nginx与前端开发_files/640(1)"
                                                                                                        crossorigin="anonymous"
                                                                                                        alt="图片"
                                                                                                        data-fail="0">
      <figcaption
        style="box-sizing: border-box;margin-top: 10px;font-size: 0.7em;color: rgb(153, 153, 153);line-height: inherit;text-align: center;">
        nginx-proxy-reverse
      </figcaption>
    </figure>
    <p>在<strong
      style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">反向代理</strong>中（事实上，这种情况基本发生在所有的大型网站的页面请求中），客户端发送的请求，想要访问server服务器上的内容。但将被发送到一个代理服务器proxy，这个代理服务器将把请求代理到和自己属于同一个LAN下的内部服务器上，而用户真正想获得的内容就储存在这些内部服务器上。看到区别了吗，这里proxy服务器代理的并不是客户，而是服务器，即向外部客户端提供了一个统一的代理入口，客户端的请求，都先经过这个proxy服务器，至于在内网真正访问哪台服务器内容，由这个proxy去控制。一般代理是指代理客户端，而这里代理的对象是服务器，这就是“反向”这个词的意思。Nginx就是来充当这个proxy的作用。
      概括说：就是代理服务器和真正server服务器可以直接互相访问，属于一个LAN（服务器内网）；代理对用户是<strong
        style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">透明</strong>的，即无感知。不论加不加这个反向代理，用户都是通过相同的请求进行的，且不需要任何额外的操作；代理服务器通过<strong
        style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">代理内部服务器</strong>接受域外客户端的请求，并将请求发送到对应的内部服务器上。
    </p></li>
  <li><p><strong style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">为什么要Nginx反向代理</strong>&nbsp;使用反向代理最主要的两个原因：
    1）安全及权限。可以看出，使用反向代理后，用户端将无法直接通过请求访问真正的内容服务器，而必须首先通过Nginx。可以通过在Nginx层上将危险或者没有权限的请求内容过滤掉，从而保证了服务器的安全。
    2）负载均衡。例如一个网站的内容被部署在若干台服务器上，可以把这些机子看成一个集群，那么Nginx可以将接收到的客户端请求“均匀地”分配到这个集群中所有的服务器上（内部模块提供了多种负载均衡算法），从而实现服务器压力的负载均衡。此外，nginx还带有健康检查功能（服务器心跳检查），会定期轮询向集群里的所有服务器发送健康检查请求，来检查集群中是否有服务器处于异常状态，一旦发现某台服务器异常，那么在以后代理进来的客户端请求都不会被发送到该服务器上（直到后面的健康检查发现该服务器恢复正常），从而保证客户端访问的稳定性。
  </p></li>
</ol>
<h3 class="" data-id="heading-2"
    style="box-sizing: border-box;margin-top: 1.6em;margin-bottom: 1.6em;font-weight: bold;font-size: 15px;color: rgb(62, 62, 62);line-height: inherit;border-bottom: 2px solid rgb(239, 112, 96);letter-spacing: 2px;white-space: normal;word-spacing: 2px;background-color: rgb(255, 255, 255);">
  <span
    style="box-sizing: border-box;margin-right: 3px;padding: 3px 10px 1px;font-size: inherit;color: rgb(255, 255, 255);line-height: inherit;display: inline-block;font-weight: normal;background: rgb(239, 112, 96);border-top-right-radius: 3px;border-top-left-radius: 3px;">前端可以用Nginx做些什么</span>
</h3>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  <strong
    style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">快速实现简单的访问限制</strong>&nbsp;经常会遇到希望网站让某些特定用户的群体（比如只让公司内网）访问，或者控制某个uri不让人访问。Nginx配置如下：
</p>
<pre
  style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: inherit;color: inherit;line-height: inherit;"><code
  class="" lang="nginx"
  style="box-sizing: border-box;margin-right: 2px;margin-left: 2px;padding: 0.5em;font-size: 14px;color: rgb(220, 220, 220);line-height: 18px;border-radius: 0px;background: rgb(30, 30, 30);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;word-spacing: 0px;letter-spacing: 0px;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">location</span>&nbsp;/&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">deny</span>&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">192.168.1.100</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">allow</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">192.168.1.10</span>/<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">200</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">allow</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">10.110.50.16</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">deny</span>&nbsp;&nbsp;all;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;</code></pre>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  其实deny和allow是<strong style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">ngx_http_access_module</strong>模块（已内置）中的语法。采用的是从上到下匹配方式，匹配到就跳出不再继续匹配。上述配置的意思就是，首先禁止192.168.1.100访问，然后允许192.168.1.10-200
  ip段内的访问（排除192.168.1.100），同时允许10.110.50.16这个单独ip的访问，剩下未匹配到的全部禁止访问。实际生产中，经常和<strong
  style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">ngx_http_geo_module</strong>模块（可以更好地管理ip地址表，已内置）配合使用。
</p>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  <strong style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">解决跨域</strong>&nbsp;在众多的解决跨域方式中，
  都不可避免的都需要服务端进行支持， 使用Nginx可以纯前端解决请求跨域问题。 特别是在前后端分离调试时， 经常需要在本地起前端工程， 接口希望拉取服务端的实际数据而不是本地的mock。 而如果本地程序直接访问远程接口，
  肯定会遇到跨域问题。现在前端成熟的做法，一般是把node proxy server集成进来。事实上，用Nginx同样可以解决问题，甚至可以应用于线上。 本地起一个nginx
  server。server_name是mysite-base.com，比如现在需要请求线上www.kaola.com域下的线上接口&nbsp;www.kaola.com/getPCBanner…&nbsp;的数据，当在页面里直接请求，浏览器会报错：
</p>
<figure style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;"><img class=""
                                                                                                    data-height="62"
                                                                                                    data-ratio="0.05688073394495413"
                                                                                                    data-src="https://mmbiz.qpic.cn/mmbiz/1NOXMW586usW91ALT7WS6fm56aB7eMYuhq1yFicAZgSgc6ibP7DI4GVlibGjlzhFzJflSBSgElhcibKc5hohtTicuMg/640?wx_fmt=other"
                                                                                                    data-type="other"
                                                                                                    data-w="1090"
                                                                                                    data-width="1090"
                                                                                                    style="box-sizing: border-box; margin: 0px 263.047px; border-width: 2px; border-style: solid; border-color: rgb(238, 238, 238); border-radius: 6px; font-size: inherit; color: inherit; line-height: inherit; display: block; inset: 0px; width: 677px !important; height: auto !important; visibility: visible !important;"
                                                                                                    _width="677px"
                                                                                                    src="./Nginx与前端开发_files/640(2)"
                                                                                                    crossorigin="anonymous"
                                                                                                    alt="图片"
                                                                                                    data-fail="0">
  <figcaption
    style="box-sizing: border-box;margin-top: 10px;font-size: 0.7em;color: rgb(153, 153, 153);line-height: inherit;text-align: center;"></figcaption>
</figure>
<p>为了绕开浏览器的跨域安全限制，现在需要将请求的域名改成mysite-base.com。同时约定一个url规则来表明代理请求的身份，然后Nginx通过匹配该规则，将请求代理回原来的域。Nginx配置如下：</p>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  <br></p>
<pre
  style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: inherit;color: inherit;line-height: inherit;"><code
  class="" lang="nginx"
  style="box-sizing: border-box;margin-right: 2px;margin-left: 2px;padding: 0.5em;font-size: 14px;color: rgb(220, 220, 220);line-height: 18px;border-radius: 0px;background: rgb(30, 30, 30);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;word-spacing: 0px;letter-spacing: 0px;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#请求跨域，这里约定代理请求url&nbsp;path是以/apis/开头</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">location</span><span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(154, 83, 52);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;^~/apis/</span>&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;这里重写了请求，将正则匹配中的第一个()中$1的path，拼接到真正的请求后面，并用break停止后续匹配</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">rewrite</span><span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(154, 83, 52);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;^/apis/(.*)$</span>&nbsp;/<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$1</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(86, 156, 214);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">break</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">proxy_pass</span>&nbsp;https://www.kaola.com/;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;</code></pre>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  在页面代码里，把请求url换成http://mysite-base.com/apis/getPCBannerList.html 。这样就可以正常请求到数据。
  这样其实是通过nginx，用类似于hack的方式规避掉了浏览器跨域限制，实现了跨域访问。</p>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  <strong
    style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">适配PC与移动环境</strong>&nbsp;现在很多网站都存在PC站和H5站两个站点，因此根据用户的浏览环境自动切换站点是很常见的需求。Nginx可以通过内置变量$http_user_agent，获取到请求客户端的userAgent，从而知道用户处于移动端还是PC，进而控制重定向到H5站还是PC站。
  以笔者本地为例，pc端站点是mysite-base.com，H5端是mysite-base-H5.com。pc端Nginx配置如下：</p>
<pre
  style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: inherit;color: inherit;line-height: inherit;"><code
  class="" lang="nginx"
  style="box-sizing: border-box;margin-right: 2px;margin-left: 2px;padding: 0.5em;font-size: 14px;color: rgb(220, 220, 220);line-height: 18px;border-radius: 0px;background: rgb(30, 30, 30);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;word-spacing: 0px;letter-spacing: 0px;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">location</span>&nbsp;/&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;移动、pc设备适配</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$http_user_agent</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(154, 83, 52);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">~*&nbsp;'(Android|webOS|iPhone|iPod|BlackBerry)')</span>&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$mobile_request</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'1'</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$mobile_request</span>&nbsp;=&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'1'</span>)&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">rewrite</span><span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(154, 83, 52);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;^.+</span>&nbsp;http://mysite-base-H5.com;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;</code></pre>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  这样当浏览设备切换成移动模式，再次刷新页面后，站点被自动切换到H5站。如下：</p>
<figure style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;"><img class="__bg_gif"
                                                                                                    data-height="184"
                                                                                                    data-ratio="0.8105726872246696"
                                                                                                    data-src="https://mmbiz.qpic.cn/mmbiz_gif/1NOXMW586usW91ALT7WS6fm56aB7eMYuTMrmcMicola2C2BpWG6c5hNwvJfyVUl49zTSdjoDLc0Bn1etlkwFbGA/640?wx_fmt=gif"
                                                                                                    data-type="gif"
                                                                                                    data-w="227"
                                                                                                    data-width="227"
                                                                                                    style="box-sizing: border-box; margin: 0px 263.047px; border-width: 2px; border-style: solid; border-color: rgb(238, 238, 238); border-radius: 6px; font-size: inherit; color: inherit; line-height: inherit; display: block; inset: 0px; width: 227px !important; height: auto !important; visibility: visible !important;"
                                                                                                    _width="227px"
                                                                                                    src="./Nginx与前端开发_files/640(3)"
                                                                                                    data-order="0"
                                                                                                    alt="图片"
                                                                                                    data-fail="0"><strong
  style="font-size: inherit;box-sizing: border-box;color: rgb(233, 105, 0);line-height: inherit;">合并请求</strong><span
  style="color: inherit;font-size: inherit;">&nbsp;前端性能优化中重要一点就是尽量减少http资源请求的数量。通过nginx-http-concat模块（淘宝开发的第三方模块，需要单独安装）用一种特殊的请求url规则（例子：example.com/??1.js,2.js,3.js ），前端可以将多个资源的请求合并成一个请求，后台Nginx会获取各个资源并拼接成一个结果进行返回。例如上面的例子通过一个请求将1.js,2.js,3js三个js资源合并成一个请求，减少了浏览器开销。 本地server mysite-base.com为例，static/js文件夹下有三个文件，文件内容很简单，分别为</span>
</figure>
<figure style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;"><img class=""
                                                                                                    data-height="86"
                                                                                                    data-ratio="0.10011641443538999"
                                                                                                    data-src="https://mmbiz.qpic.cn/mmbiz/1NOXMW586usW91ALT7WS6fm56aB7eMYuwR3svRXbSesWg6jAU0Qy8TBvDRxdDkia6df5XibKSI8JAEs9FhWIXKibw/640?wx_fmt=other"
                                                                                                    data-type="other"
                                                                                                    data-w="859"
                                                                                                    data-width="859"
                                                                                                    style="box-sizing: border-box; margin: 0px 263.047px; border-width: 2px; border-style: solid; border-color: rgb(238, 238, 238); border-radius: 6px; font-size: inherit; color: inherit; line-height: inherit; display: block; inset: 0px; width: 677px !important; height: auto !important; visibility: visible !important;"
                                                                                                    _width="677px"
                                                                                                    src="./Nginx与前端开发_files/640(4)"
                                                                                                    crossorigin="anonymous"
                                                                                                    alt="图片"
                                                                                                    data-fail="0">
  <figcaption
    style="box-sizing: border-box;margin-top: 10px;font-size: 0.7em;color: rgb(153, 153, 153);line-height: inherit;text-align: center;"></figcaption>
</figure>
<p>Nginx配置如下：</p>
<pre
  style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: inherit;color: inherit;line-height: inherit;"><code
  class="" lang="nginx"
  style="box-sizing: border-box;margin-right: 2px;margin-left: 2px;padding: 0.5em;font-size: 14px;color: rgb(220, 220, 220);line-height: 18px;border-radius: 0px;background: rgb(30, 30, 30);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;word-spacing: 0px;letter-spacing: 0px;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;js资源http-concat</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;nginx-http-concat模块的参数远不止下面三个，剩下的请查阅文档</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">location</span>&nbsp;/static/js/&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">concat</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(86, 156, 214);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">on</span>;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;是否打开资源合并开关</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">concat_types</span>&nbsp;application/javascript;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;允许合并的资源类型</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">concat_unique</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(86, 156, 214);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">off</span>;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;是否允许合并不同类型的资源</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">concat_max_files</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">5</span>;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;允许合并的最大资源数目</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;</code></pre>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  当在浏览器请求http://mysite-base.com/static/js/??a.js,b.js,c.js 时，发现三个js被合并成一个返回了</p>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  <strong style="box-sizing: border-box;color: rgb(233, 105, 0);font-size: inherit;line-height: inherit;">图片处理</strong>&nbsp;在前端开发中，经常需要不同尺寸的图片。现在的云储存基本对图片都提供有处理服务（一般是通过在图片链接上加参数）。其实用Nginx，可以通过几十行配置，搭建出一个属于自己的本地图片处理服务，完全能够满足日常对图片的裁剪/缩放/旋转/图片品质等处理需求。要用到ngx_http_image_filter_module模块。这个模块是非基本模块，需要安装。
  下面是图片缩放功能部分的Nginx配置：</p>
<pre
  style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: inherit;color: inherit;line-height: inherit;"><code
  class="" lang="nginx"
  style="box-sizing: border-box;margin-right: 2px;margin-left: 2px;padding: 0.5em;font-size: 14px;color: rgb(220, 220, 220);line-height: 18px;border-radius: 0px;background: rgb(30, 30, 30);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;word-spacing: 0px;letter-spacing: 0px;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;">&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;图片缩放处理</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;这里约定的图片处理url格式：以&nbsp;mysite-base.com/img/路径访问</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">location</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(154, 83, 52);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">~*&nbsp;/img/(.+)$</span>&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">alias</span>&nbsp;/Users/cc/Desktop/server/static/image/<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$1</span>;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#图片服务端储存地址</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$width</span>&nbsp;-;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#图片宽度默认值</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$height</span>&nbsp;-;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#图片高度默认值</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$arg_width</span>&nbsp;!=&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">""</span>)&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$width</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$arg_width</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$arg_height</span>&nbsp;!=&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">""</span>)&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$height</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$arg_height</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">image_filter</span>&nbsp;resize&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$width</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$height</span>;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#设置图片宽高</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">image_filter_buffer</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">10M</span>;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#设置Nginx读取图片的最大buffer。</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">image_filter_interlace</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(86, 156, 214);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">on</span>;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#是否开启图片图像隔行扫描</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">error_page</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">415</span>&nbsp;=&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">415</span>.png;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#图片处理错误提示图，例如缩放参数不是数字</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;&lt;/span&nbsp;class="hljs-attribute"&gt;</code></pre>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  <span style="color: inherit;font-size: inherit;">这里只是最基本的配置。此外，可以通过proxy_cache配置Nginx缓存，避免每次请求都重新处理图片，减少Nginx服务器处理压力；还以可以通过和nginx-upload-module一起使用加入图片上传的功能等。</span><br>
</p>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  <strong
    style="font-size: inherit;box-sizing: border-box;color: rgb(233, 105, 0);line-height: inherit;">页面内容修改</strong><span
  style="color: inherit;font-size: inherit;">&nbsp;Nginx可以通过向页面底部或者顶部插入额外的css和js文件，从而实现修改页面内容。这个功能需要额外模块的支持，例如：nginx_http_footer_filter或者ngx_http_addition_module&nbsp;(都需要安装)。 工作中，经常需要切换各种测试环境，而通过switchhosts等工具切换后，有时还需要清理浏览器dns缓存。可以通过页面内容修改+Nginx反向代理来实现轻松快捷的环境切换。 这里首先在本地编写一段js代码（switchhost.js），里面的逻辑是：在页面插入hosts切换菜单以及点击具体某个环境时，将该host的ip和hostname储存在cookie中，最后刷新页面；接着编写一段css代码（switchhost.css）用来设置该hosts切换菜单的样式。 然后Nginx脚本配置：</span><br>
</p>
<pre
  style="box-sizing: border-box;margin-top: 0px;margin-bottom: 0px;padding: 0px;font-size: inherit;color: inherit;line-height: inherit;"><code
  class="" lang="nginx"
  style="box-sizing: border-box;margin-right: 2px;margin-left: 2px;padding: 0.5em;font-size: 14px;color: rgb(220, 220, 220);line-height: 18px;border-radius: 0px;background: rgb(30, 30, 30);font-family: Consolas, Inconsolata, Courier, monospace;display: block;overflow-x: auto;word-spacing: 0px;letter-spacing: 0px;word-wrap: normal !important;word-break: normal !important;overflow-y: auto !important;"><span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: gold;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">server</span>&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">listen</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">80</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">listen</span>&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">443</span>&nbsp;ssl;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">expires</span>&nbsp;-<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;想要代理的域名</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">server_name</span>&nbsp;m-element.kaola.com;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$root</span>&nbsp;/Users/cc/Desktop/server;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">charset</span>&nbsp;utf-<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">8</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">ssl_certificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/usr/local/etc/nginx/m-element.kaola.com.crt;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">ssl_certificate_key</span>&nbsp;&nbsp;/usr/local/etc/nginx/m-element.kaola.com.key;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;设置默认$switch_host，一般默认为线上host，这里的1.1.1.1随便写的</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$switch_host</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'1.1.1.1'</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;设置默认$switch_hostname，一般默认为线上'online'</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$switch_hostname</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">''</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;从cookie中获取环境ip</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$http_cookie</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(154, 83, 52);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">~*&nbsp;"switch_host=(.+?)(?=</span>;|$)")&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$switch_host</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$1</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;从cookie中获取环境名</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">if</span>&nbsp;(<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$http_cookie</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(154, 83, 52);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">~*&nbsp;"switch_hostname=(.+?)(?=</span>;|$)")&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$switch_hostname</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$1</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">location</span>&nbsp;/&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">expires</span>&nbsp;-<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(184, 215, 163);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">1</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">index</span>&nbsp;index.html;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">proxy_set_header</span>&nbsp;Host&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$host</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#把html页面的gzip压缩去掉，不然sub_filter无法替换内容</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">proxy_set_header</span>&nbsp;Accept-Encoding&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">''</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#反向代理到实际服务器ip</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">proxy_pass</span>&nbsp;&nbsp;http://<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$switch_host</span>:80;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#全部替换</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">sub_filter_once</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(86, 156, 214);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">off</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#ngx_http_addition_module模块替换内容。</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;这里在头部插入一段css，内容是hosts切换菜单的css样式</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">sub_filter</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'&lt;/head&gt;'</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'&lt;/head&gt;&lt;link&nbsp;rel="stylesheet"&nbsp;type="text/css"&nbsp;media="screen"&nbsp;href="/local/switchhost.css"&nbsp;/&gt;'</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#将页面中的'网易考拉'文字后面加上环境名，便于开发识别目前环境</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">sub_filter</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'网易考拉'</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'网易考拉:<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">${switch_hostname}</span>'</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#这里用了另一个模块nginx_http_footer_filter，其实上面的模块就行，只是为了展示用法</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;最后插入一段js，内容是hosts切换菜单的js逻辑</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">set</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$injected</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'&lt;script&nbsp;language="javascript"&nbsp;src="/local/switchhost.js"&gt;&lt;/script&gt;'</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">footer</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(214, 157, 133);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">'<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">${injected}</span>'</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;对于/local/请求，优先匹配本地文件</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(87, 166, 74);line-height: inherit;font-style: italic;word-wrap: inherit !important;word-break: inherit !important;">#&nbsp;所以上面的/local/switchhost.css，/local/switchhost.js会从本地获取</span><br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">location</span><span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(154, 83, 52);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;^~</span>&nbsp;/local/&nbsp;{<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(156, 220, 254);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">root</span>&nbsp;<span
  class=""
  style="box-sizing: border-box;font-size: inherit;color: rgb(189, 99, 197);line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">$root</span>;<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;">}<br
  style="box-sizing: border-box;font-size: inherit;color: inherit;line-height: inherit;word-wrap: inherit !important;word-break: inherit !important;"></code></pre>
<p
  style="box-sizing: border-box;margin-top: 1.7em;margin-bottom: 1.7em;font-size: inherit;color: inherit;line-height: inherit;">
  这个功能其实为Nginx在前端开发中的应用提供了无限可能。例如，可以通过区分本地、测试和线上环境，为本地/测试环境页面增加很多开发辅助功能：给本地页面加一个常驻二维码便于手机端扫码调试；本地调试线上页面时，在js文件底部塞入sourceMappingURL，便于本地debug等等。</p>
<blockquote
  style="max-width: 100%;color: rgb(51, 51, 51);font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 17px;letter-spacing: 0.544px;text-align: justify;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">
  <p>作者:ccfe</p>
  <p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">
    https://juejin.im/post/5bacbd395188255c8d0fd4b2</p></blockquote>


</body>
</html>